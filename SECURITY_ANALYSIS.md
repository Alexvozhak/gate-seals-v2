# –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ GateSeal

## –û–±–∑–æ—Ä
GateSeal - —ç—Ç–æ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç "–ø–∞–Ω–∏–∫-–∫–Ω–æ–ø–∫–∏" –¥–ª—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –≤ —á—Ä–µ–∑–≤—ã—á–∞–π–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö. –ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã Lido.

## üêõ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –±–∞–≥–∏ –∏ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

### 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π DoS –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**: –í —Ñ—É–Ω–∫—Ü–∏–∏ `_has_duplicates` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏–Ω–µ–π–Ω—ã–π –ø–æ–∏—Å–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞, —á—Ç–æ –¥–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å O(n¬≤). –ü—Ä–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ sealables (8) —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ.

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å—Ä–µ–¥–Ω–µ–π –≤–∞–∂–Ω–æ—Å—Ç–∏

#### 2.1 –ù–µ—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∑–∞–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏—è
```vyper
# –í —Å—Ç—Ä–æ–∫–µ 253-261 contracts/GateSeal.vy
if success and staticcall IPausableUntil(sealable).isPaused():
    log Sealed(...)
else:
    failed_indexes.append(sealable_index)
```
**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–Ω—Ç—Ä–∞–∫—Ç —Å—á–∏—Ç–∞–µ—Ç –∑–∞–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏–µ –Ω–µ—É—Å–ø–µ—à–Ω—ã–º, –µ—Å–ª–∏ `isPaused()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `False`, –¥–∞–∂–µ –µ—Å–ª–∏ `pauseFor()` –±—ã–ª –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –∏–∑-–∑–∞ race conditions –∏–ª–∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ pausable –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.

#### 2.2 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
–í —Ñ—É–Ω–∫—Ü–∏–∏ `prolong()` –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ `PROLONGATION_DURATION_SECONDS` –∫ `expiry_timestamp`.

#### 2.3 –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —á–∏—Å–µ–ª –≤ —Å—Ç—Ä–æ–∫—É
–§—É–Ω–∫—Ü–∏—è `_to_error_string` –º–æ–∂–µ—Ç —Ç–µ—Ä—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ —Å—Ç—Ä–æ–∫—É –∏–∑-–∑–∞ –ø–æ—Ç–µ—Ä–∏ –≤–µ–¥—É—â–∏—Ö –Ω—É–ª–µ–π.

### 3. –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏

#### 3.1 –ù–µ–æ—á–µ–≤–∏–¥–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –æ—à–∏–±–æ–∫
–í `_to_error_string` –∏–Ω–¥–µ–∫—Å—ã –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–æ—Ç–µ—Ä–∏ –≤–µ–¥—É—â–∏—Ö –Ω—É–ª–µ–π, –Ω–æ —ç—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—É –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ.

#### 3.2 –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ Factory
`GateSealFactory` –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ `GateSeal`, —á—Ç–æ –º–æ–∂–µ—Ç —É—Å–ª–æ–∂–Ω–∏—Ç—å –æ—Ç–ª–∞–¥–∫—É –æ—à–∏–±–æ–∫.

## üìù –û–ø–µ—á–∞—Ç–∫–∏ –∏ –∫—Ä–∏–≤—ã–µ —Ñ—Ä–∞–∑—ã

### 1. –û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- `initilization` ‚Üí `initialization` (—Å—Ç—Ä–æ–∫–∞ 67, README.md)
- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏–µ–π –≤ –∫–æ–¥–µ

### 2. –ù–µ—Ç–æ—á–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- "pinky-promise" –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (—Å—Ç—Ä–æ–∫–∞ 70, GateSeal.vy) - –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è production –∫–æ–¥–∞
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ –º–æ–≥–ª–∏ –±—ã –±—ã—Ç—å –±–æ–ª–µ–µ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–º–∏

### 3. Inconsistent naming
- `gate_seal` vs `gateSeal` –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö –ø—Ä–æ–µ–∫—Ç–∞
- `sealables` vs `pausables` - —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è –º–æ–∂–µ—Ç —Å–±–∏–≤–∞—Ç—å —Å —Ç–æ–ª–∫—É

## üß™ –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã

### 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### 1.1 –¢–µ—Å—Ç—ã –Ω–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
```python
def test_prolong_timestamp_overflow():
    # –¢–µ—Å—Ç –Ω–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ expiry_timestamp –ø—Ä–∏ prolongation
    # –û—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–µ–Ω –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ —Å –±–æ–ª—å—à–∏–º PROLONGATION_DURATION_SECONDS
```

#### 1.2 –¢–µ—Å—Ç—ã –Ω–∞ –≥–∞–∑-–ª–∏–º–∏—Ç—ã
```python
def test_seal_gas_consumption_max_sealables():
    # –¢–µ—Å—Ç –Ω–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –≥–∞–∑–∞ –ø—Ä–∏ –∑–∞–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
    
def test_seal_partial_failures_gas():
    # –¢–µ—Å—Ç –Ω–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –≥–∞–∑–∞ –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Å–±–æ—è—Ö –∑–∞–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏—è
```

#### 1.3 –¢–µ—Å—Ç—ã –Ω–∞ reentrancy
```python
def test_seal_reentrancy_protection():
    # –¢–µ—Å—Ç –Ω–∞ –∑–∞—â–∏—Ç—É –æ—Ç reentrancy –∞—Ç–∞–∫ —á–µ—Ä–µ–∑ malicious pausable –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
```

#### 1.4 –¢–µ—Å—Ç—ã –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
```python
def test_expiry_at_exact_timestamp():
    # –¢–µ—Å—Ç –ø–æ–≤–µ–¥–µ–Ω–∏—è —Ç–æ—á–Ω–æ –≤ –º–æ–º–µ–Ω—Ç –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
    
def test_prolong_at_exact_expiry():
    # –¢–µ—Å—Ç –ø—Ä–æ–¥–ª–µ–Ω–∏—è —Ç–æ—á–Ω–æ –≤ –º–æ–º–µ–Ω—Ç –∏—Å—Ç–µ—á–µ–Ω–∏—è
```

### 2. Edge cases

#### 2.1 –¢–µ—Å—Ç—ã –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ pausable –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
```python
def test_seal_pausable_with_custom_return_values():
    # –¢–µ—Å—Ç —Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–º–∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    
def test_seal_pausable_with_large_gas_consumption():
    # –¢–µ—Å—Ç —Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏, –ø–æ—Ç—Ä–µ–±–ª—è—é—â–∏–º–∏ –º–Ω–æ–≥–æ –≥–∞–∑–∞
```

#### 2.2 –¢–µ—Å—Ç—ã –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫—á–µ–π–Ω–∞
```python
def test_behavior_during_blockchain_reorg():
    # –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –±–ª–æ–∫—á–µ–π–Ω–∞
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```python
def test_factory_multiple_deployments():
    # –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö GateSeal —á–µ—Ä–µ–∑ Factory
    
def test_cross_gate_seal_interactions():
    # –¢–µ—Å—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ GateSeal –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏
```

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### 1.1 –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∑–∞–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏—è
```vyper
# –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ
was_paused_before: bool = staticcall IPausableUntil(sealable).isPaused()
success, response = raw_call(...)
is_paused_after: bool = staticcall IPausableUntil(sealable).isPaused()

# –°—á–∏—Ç–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–º –µ—Å–ª–∏:
# 1. raw_call –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ –ò 
# 2. (–∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å—Ç–∞–ª paused –ò–õ–ò —É–∂–µ –±—ã–ª paused)
if success and (is_paused_after or was_paused_before):
    # —É—Å–ø–µ—Ö
```

#### 1.2 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
```vyper
def prolong():
    assert msg.sender == SEALING_COMMITTEE, "sender: not SEALING_COMMITTEE"
    assert not self._is_expired(), "gate seal: expired"
    assert self.prolongations_remaining > 0, "prolongations: exhausted"
    
    # –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
    new_expiry: uint256 = self.expiry_timestamp + PROLONGATION_DURATION_SECONDS
    assert new_expiry > self.expiry_timestamp, "expiry: overflow"
    
    self.expiry_timestamp = new_expiry
    self.prolongations_remaining -= 1
```

#### 1.3 –£–ª—É—á—à–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—à–∏–±–æ–∫
```vyper
@internal
@pure
def _to_error_string(_failed_indexes: DynArray[uint256, MAX_SEALABLES]) -> String[100]:
    if len(_failed_indexes) == 0:
        return "no failures"
    
    error_msg: String[100] = "failed sealable indexes: "
    for i in range(len(_failed_indexes)):
        if i > 0:
            error_msg = concat(error_msg, ",")
        error_msg = concat(error_msg, uint2str(_failed_indexes[i]))
    
    return error_msg
```

### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

#### 2.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```vyper
event ProlongationUsed:
    gate_seal: address
    new_expiry: uint256
    prolongations_remaining: uint256

event SealingAttempted:
    gate_seal: address
    attempted_sealables: DynArray[address, MAX_SEALABLES]
    successful_count: uint256
    failed_count: uint256
```

#### 2.2 –£–ª—É—á—à–µ–Ω–∏–µ Factory
```vyper
# –î–æ–±–∞–≤–∏—Ç—å pre-validation –≤ Factory
@external
@view
def validate_gate_seal_params(
    _sealing_committee: address,
    _seal_duration_seconds: uint256,
    _sealables: DynArray[address, MAX_SEALABLES],
    _expiry_timestamp: uint256,
    _prolongations: uint256,
    _prolongation_duration_seconds: uint256
) -> bool:
    # –î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑ GateSeal –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
    # –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```

### 3. –£–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

#### 3.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ NatSpec –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
```vyper
@external
def seal(_sealables: DynArray[address, MAX_SEALABLES]):
    """
    @notice –ó–∞–ø–µ—á–∞—Ç—ã–≤–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
    @dev –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∏—Å—Ç–µ–∫–∞–µ—Ç GateSeal, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
    @param _sealables –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –¥–ª—è –∑–∞–ø–µ—á–∞—Ç—ã–≤–∞–Ω–∏—è (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ–º)
    @custom:security –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –æ—à–∏–±–∫–∏
    @custom:gas-optimization –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–æ–ø—ã—Ç–∫–∏ —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏
    """
```

#### 3.2 –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –º–∞–≥–∏—á–µ—Å–∫–∏—Ö —á–∏—Å–µ–ª
```vyper
# –í–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–π
EIP5202_HEADER_SIZE: constant(uint256) = 3
UINT256_MAX: constant(uint256) = 2**256 - 1
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å

#### 4.1 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ view —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```vyper
@external
@view
def get_time_until_expiry() -> uint256:
    if self._is_expired():
        return 0
    return self.expiry_timestamp - block.timestamp

@external  
@view
def can_prolong() -> bool:
    return (not self._is_expired() and 
            self.prolongations_remaining > 0)

@external
@view
def get_seal_status() -> (bool, uint256, uint256):
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: (expired, time_until_expiry, prolongations_remaining)
    return (self._is_expired(), 
            self.get_time_until_expiry(), 
            self.prolongations_remaining)
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≥–∞–∑–∞
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ `staticcall` –¥–ª—è `isPaused()`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ bitmap –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è failed sealables –≤–º–µ—Å—Ç–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –º–∞—Å—Å–∏–≤–∞

### 2. –£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–æ–ª—å—à–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `seal()` –Ω–∞ –º–µ–Ω—å—à–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ helper —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### 3. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ EIP-165 –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- –£–ª—É—á—à–µ–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ pausable –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏

## üìä –û—Ü–µ–Ω–∫–∞ –æ–±—â–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- –•–æ—Ä–æ—à–æ –ø—Ä–æ–¥—É–º–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤  
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Blueprint
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤ —á–µ—Ä–µ–∑ `raw_call`

**–û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:**
- –ü–æ–∫—Ä—ã—Ç–∏–µ edge cases —Ç–µ—Å—Ç–∞–º–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: 8/10**
–ü—Ä–æ–µ–∫—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∑—Ä–µ–ª–æ—Å—Ç–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ –æ–±–ª–∞—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.